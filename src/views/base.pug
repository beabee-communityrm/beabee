include mixins.pug
doctype html
html
	head
		meta( charset="utf-8" )
		meta( name="viewport", content="initial-scale=1.0, width=device-width" )

		link( rel="apple-touch-icon", sizes="180x180", href="/apple-touch-icon.png" )
		link( rel="icon", type="image/png", sizes="32x32", href="/favicon-32x32.png" )
		link( rel="icon", type="image/png", sizes="16x16", href="/favicon-16x16.png" )
		link( rel="manifest", href="/site.webmanifest" )
		link( rel="mask-icon", href="/safari-pinned-tab.svg", color="#5bbad5" )
		meta( name="msapplication-TileColor", content="#da532c" )
		meta( name="theme-color", content="#ffffff" )

		block meta
			include partials/share-meta.pug

		block title
			if title
				title #{ title } &mdash; #{ Options( 'software-name' ) } &mdash; #{ Options( 'organisation' ) }
			else
				title #{ Options( 'software-name' ) } &mdash; #{ Options( 'organisation' ) }
		block head
			block css
				link( rel="stylesheet", href="/static/css/theme.css?v=" + git )
				link( rel="stylesheet", href="/static/css/style.css?v=" + git )
	body( class=( dev ? 'dev' : '' ) )
		script.
			document.body.className += ' has-js';

		.wrapper
			block header
				header.header
					.container
						.row
							.col-xs-6
								a( href=Options( 'home-link-url' ) )
									img( src=Options('logo') ).header-logo
							.col-xs-6.text-right
								block login
									if isLoggedIn
										a( href="/logout" ) Logout
									else
										a( href="/login" ) Login


			main.main
				block body
					.container
						block navbar
							include partials/navbar.pug
						block flashes
							include partials/flash.pug
						block heading
							if heading
								+page_header( heading )
						block contents

			footer.footer.small
				.container
					.row
						.col-sm-6
							p
								= Options( 'organisation' )
								br
								= Options( 'footer-strapline' )
						.col-sm-6
							ul.footer-links
								li
									a( href=Options( 'footer-privacy-link-url' ) )= Options( 'footer-privacy-link-text' )
								li
									a( href=Options( 'footer-terms-link-url' ) )= Options( 'footer-terms-link-text' )
								if Options( 'footer-facebook-link-url' )
									li
										a( href=Options( 'footer-facebook-link-url' ) ) Facebook
								if Options( 'footer-twitter-link-url' )
									li
										a( href=Options( 'footer-twitter-link-url' ) ) Twitter

					.row
						.col-sm-12
							a( href="https://github.com/thebristolcable/membership-system", target="_blank" ) Contribute on GitHub
							span.text-muted  (#{ git })

		block js
			script( src="/static/js/lib/jquery.js" )
			script( src="/static/js/lib/bootstrap.js" )
			script( src="/static/js/script.js?v=" + git )


		script( src="/membership.js" )

		block tracking
			if Options('tracking')
				script.
					var _paq = window._paq || [];
					/* tracker methods like "setCustomDimension" should be called before "trackPageView" */

					_paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
					_paq.push(["setCookieDomain", "*.thebristolcable.org"]);

					if (Membership.memberId) {
						_paq.push(["setUserId", Membership.memberId]);
					}

					_paq.push(['trackPageView']);
					_paq.push(['enableLinkTracking']);
					(function() {
						var u="https://stats2.xtreamlab.net/";
						_paq.push(['setTrackerUrl', u+'piwik.php']);
						_paq.push(['setSiteId', '1']);
						var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
						g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
					})();

				noscript
					p
						img(src="https://stats2.xtreamlab.net/piwik.php?idsite=1&amp;rec=1" style="border:0;" alt="")
