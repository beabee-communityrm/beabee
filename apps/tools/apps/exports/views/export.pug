extends /src/views/base.pug

block prepend title
	- title = 'Export'

block contents
	.row
		.col-md-12
			+page_header(exportDetails.description)
			p.
				#{exportType.name}, created
				#{moment(exportDetails.date).format('DD/MM/YYYY [at] HH:mm')}

			p
				| There are #{exportItems.length} #{exportType.itemName} in this export.

			if exportDetails.params
				dl.dl-horizontal
					each value, name in exportDetails.params
						dt= name
						dd= value

			.panel-group#items
				.panel.panel-default
					.panel-heading
						h5.panel-title
							a(data-toggle="collapse" data-parent="#items" href="#new_items").
								New #{exportType.itemName} (#{newItems.length})
					.panel-collapse.collapse#new_items
						.panel-body
							!= renderItems(newItems)
				for status in exportItemsByStatus
					.panel.panel-default
						.panel-heading
							h5.panel-title
								a(data-toggle="collapse" data-parent="#items" href="#" + status.name + "_items")
									| Existing #{exportType.itemName} - #{status.name}
									|
									| (#{status.items.length})
						.panel-collapse.collapse(id=status.name + "_items")
							.panel-body
								!= renderItems(status.items)

			form(method='POST')
				+csrf
				input(type='hidden', name='action', value='add')
				button(dsiabled=newItems.length === 0).btn.btn-primary Add new


	.row
		.col-md-8
			hr

			h4 Run export
			p Export a CSV of all #{exportType.itemName} with a given status
			form(method='POST', target='_blank').form-horizontal
				+csrf
				input(type='hidden', name='action', value='export')

				.form-group
					label(for='status').form-label.col-md-3 Status
					.col-md-4
						select(id='status', name='status').form-control
							option(value='') -- All --
							each status in exportType.statuses
								option= status

				button.btn.btn-primary Export

			hr

			h4 Update #{exportType.itemName}
			form(method='POST').form-horizontal
				+csrf
				input(type='hidden', name='action', value='update')

				.form-group
					label(for='old_status').form-label.col-md-3 Old status
					.col-md-4
						select(id='old_status', name='old_status').form-control
							each status in exportType.statuses
								option= status

				.form-group
					label(for='new_status').form-label.col-md-3 New status
					.col-md-4
						select(id='new_status', name='status').form-control
							each status in exportType.statuses
								option= status

				p
					label.checkbox-inline
						input(type='checkbox' required)
						| This change is irreversible, confirm to proceed

				button.btn.btn-warning Update

			hr

			h4 Delete export

			form(method='POST')
				+csrf
				input(type='hidden', name='action', value='delete')
				p
					label.checkbox-inline
						input(type='checkbox' required)
						| This change is irreversible, confirm to proceed
				button.btn.btn-danger.outline Delete
